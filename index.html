<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PSL Facial Rater</title>
<style>
body {
    background: black;
    color: white;
    text-align: center;
    font-family: Arial, sans-serif;
}
.container {
    max-width: 500px;
    margin: auto;
    padding: 20px;
    background: #111;
    border-radius: 10px;
}
input, button { margin: 10px; }
.hidden { display: none; }
#resultCard {
    margin-top: 20px;
    background: #222;
    padding: 15px;
    border-radius: 10px;
}
img { max-width: 100%; border-radius: 10px; margin-top: 10px; }
</style>
</head>
<body>
<div class="container">
    <h1>PSL Facial Rater</h1>
    <input type="file" id="imageUpload" accept="image/*">
    <button onclick="analyzeFace()">Rate Me</button>
    <div id="loading" class="hidden">Analyzing...</div>
    <div id="resultCard" class="hidden">
        <h2 id="label"></h2>
        <p>PSL Score: <span id="pslScore"></span></p>
        <p>Beauty Score: <span id="beautyScore"></span></p>
        <img id="uploadedImg">
    </div>
</div>

<!-- Load face-api.js -->
<script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
<script>
function convertBeautyToPSL(score) {
    if (score < 4) return { psl: 2, label: "Subhuman" };
    if (score < 5) return { psl: 3.5, label: "MTN" };
    if (score < 6) return { psl: 5, label: "HTN" };
    if (score < 7) return { psl: 5.5, label: "Chadlite" };
    return { psl: 6.5, label: "Giga Chad" };
}

async function analyzeFace() {
    const file = document.getElementById("imageUpload").files[0];
    if (!file) return alert("Upload a photo first!");

    document.getElementById("loading").classList.remove("hidden");
    document.getElementById("resultCard").classList.add("hidden");

    const img = await faceapi.bufferToImage(file);
    document.getElementById("uploadedImg").src = URL.createObjectURL(file);

    const detection = await faceapi.detectSingleFace(img).withFaceLandmarks();
    if (!detection) {
        alert("No face detected!");
        document.getElementById("loading").classList.add("hidden");
        return;
    }

    // Get symmetry & ratios
    const landmarks = detection.landmarks;
    const leftEye = landmarks.getLeftEye();
    const rightEye = landmarks.getRightEye();
    const nose = landmarks.getNose();
    const jaw = landmarks.getJawOutline();

    const eyeDistance = dist(midpoint(leftEye), midpoint(rightEye));
    const noseToChin = dist(midpoint(nose), jaw[8]);
    const symmetry = Math.abs(dist(leftEye[0], nose[0]) - dist(rightEye[3], nose[0]));

    // Beauty score formula (fake but believable)
    let beauty = 7 - (symmetry * 5 / eyeDistance) - Math.abs((eyeDistance / noseToChin) - 0.46) * 10;
    beauty = Math.max(1, Math.min(8, beauty));

    const pslData = convertBeautyToPSL(beauty);

    document.getElementById("label").innerText = pslData.label;
    document.getElementById("pslScore").innerText = pslData.psl;
    document.getElementById("beautyScore").innerText = beauty.toFixed(2);

    document.getElementById("loading").classList.add("hidden");
    document.getElementById("resultCard").classList.remove("hidden");
}

function dist(p1, p2) {
    return Math.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2);
}
function midpoint(points) {
    return { x: (points[0].x + points[3].x) / 2, y: (points[0].y + points[3].y) / 2 };
}

window.onload = async () => {
    await faceapi.nets.ssdMobilenetv1.loadFromUri("https://cdn.jsdelivr.net/npm/face-api.js/models");
    await faceapi.nets.faceLandmark68Net.loadFromUri("https://cdn.jsdelivr.net/npm/face-api.js/models");
};
</script>
</body>
</html>
