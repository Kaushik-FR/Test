<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PSL Facial Rater</title>
<style>
body {
    background: black;
    color: white;
    text-align: center;
    font-family: Arial, sans-serif;
}
.container {
    max-width: 500px;
    margin: auto;
    padding: 20px;
    background: #111;
    border-radius: 10px;
}
input, button { margin: 10px; }
.hidden { display: none; }
#resultCard {
    margin-top: 20px;
    background: #222;
    padding: 15px;
    border-radius: 10px;
}
img { max-width: 100%; border-radius: 10px; margin-top: 10px; }
</style>
</head>
<body>
<div class="container">
    <h1>PSL Facial Rater</h1>
    <input type="file" id="imageUpload" accept="image/*">
    <button onclick="analyzeFace()">Rate Me</button>
    <div id="loading" class="hidden">Analyzing...</div>
    <div id="resultCard" class="hidden">
        <h2 id="label"></h2>
        <p>PSL Score: <span id="pslScore"></span></p>
        <p>Beauty Score: <span id="beautyScore"></span></p>
        <img id="uploadedImg">
    </div>
</div>

<script>
const RAPID_KEY = "27f441c475mshe696c1d2052aad2p1ab1fejsn0e6a117bd453";

function convertBeautyToPSL(score) {
    if (score < 4) return { psl: 2, label: "Subhuman" };
    if (score < 5) return { psl: 3.5, label: "MTN" };
    if (score < 6) return { psl: 5, label: "HTN" };
    if (score < 7) return { psl: 5.5, label: "Chadlite" };
    return { psl: 6.5, label: "Giga Chad" };
}

async function analyzeFace() {
    const file = document.getElementById("imageUpload").files[0];
    if (!file) return alert("Upload a photo first!");

    document.getElementById("loading").classList.remove("hidden");
    document.getElementById("resultCard").classList.add("hidden");

    const base64 = await toBase64(file);

    try {
        const res = await fetch("https://face-beauty-score.p.rapidapi.com/beauty-score", {
            method: "POST",
            headers: {
                "content-type": "application/json",
                "X-RapidAPI-Key": RAPID_KEY,
                "X-RapidAPI-Host": "face-beauty-score.p.rapidapi.com"
            },
            body: JSON.stringify({ image_base64: base64 })
        });
        const data = await res.json();
        console.log(data);

        if (!data.score) throw new Error("No score returned");

        const beauty = parseFloat(data.score);
        const pslData = convertBeautyToPSL(beauty);

        document.getElementById("label").innerText = pslData.label;
        document.getElementById("pslScore").innerText = pslData.psl;
        document.getElementById("beautyScore").innerText = beauty.toFixed(2);

        document.getElementById("uploadedImg").src = URL.createObjectURL(file);

        document.getElementById("loading").classList.add("hidden");
        document.getElementById("resultCard").classList.remove("hidden");

    } catch (err) {
        console.error(err);
        alert("Error analyzing face.");
        document.getElementById("loading").classList.add("hidden");
    }
}

function toBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(",")[1]);
        reader.onerror = err => reject(err);
    });
}
</script>
</body>
</html>
